/**
 * skylark-videojs - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-videojs-vtt","./text-track-cue-list","../utils/fn","./track-enums","../utils/log","./track","../utils/url","../utils/xhr","../utils/merge-options"],function(e,t,s,i,n,r,o,c,h){"use strict";const u=function(t,s){const i=new e.WebVTT.Parser(window,e,e.WebVTT.StringDecoder()),r=[];i.oncue=function(e){s.addCue(e)},i.onparsingerror=function(e){r.push(e)},i.onflush=function(){s.trigger({type:"loadeddata",target:s})},i.parse(t),r.length>0&&(window.console&&window.console.groupCollapsed&&window.console.groupCollapsed(`Text Track parsing errors for ${s.src}`),r.forEach(e=>n.error(e)),window.console&&window.console.groupEnd&&window.console.groupEnd()),i.flush()},d=function(t,i){const r={uri:t},h=o.isCrossOrigin(t);h&&(r.cors=h);const d="use-credentials"===i.tech_.crossOrigin();d&&(r.withCredentials=d),c(r,s.bind(this,function(t,s,r){if(t)return n.error(t,s);i.loaded_=!0,"function"!=typeof e.WebVTT?i.tech_&&i.tech_.any(["vttjsloaded","vttjserror"],e=>{if("vttjserror"!==e.type)return u(r,i);n.error(`vttjs failed to load, stopping trying to process ${i.src}`)}):u(r,i)}))};class a extends r{constructor(e={}){if(!e.tech)throw new Error("A tech was not provided.");const n=h(e,{kind:i.TextTrackKind[e.kind]||"subtitles",language:e.language||e.srclang||""});let r=i.TextTrackMode[n.mode]||"disabled";const o=n.default;"metadata"!==n.kind&&"chapters"!==n.kind||(r="hidden"),super(n),this.tech_=n.tech,this.cues_=[],this.activeCues_=[],this.preload_=!1!==this.tech_.preloadTextTracks;const c=new t(this.cues_),u=new t(this.activeCues_);let a=!1;const l=s.bind(this,function(){this.tech_.isReady_&&!this.tech_.isDisposed()&&(this.activeCues=this.activeCues,a&&(this.trigger("cuechange"),a=!1))});this.tech_.one("dispose",()=>{this.tech_.off("timeupdate",l)}),"disabled"!==r&&this.tech_.on("timeupdate",l),Object.defineProperties(this,{default:{get:()=>o,set(){}},mode:{get:()=>r,set(e){i.TextTrackMode[e]&&r!==e&&(r=e,this.preload_||"disabled"===r||0!==this.cues.length||d(this.src,this),this.tech_.off("timeupdate",l),"disabled"!==r&&this.tech_.on("timeupdate",l),this.trigger("modechange"))}},cues:{get(){return this.loaded_?c:null},set(){}},activeCues:{get(){if(!this.loaded_)return null;if(0===this.cues.length)return u;const e=this.tech_.currentTime(),t=[];for(let s=0,i=this.cues.length;s<i;s++){const i=this.cues[s];i.startTime<=e&&i.endTime>=e?t.push(i):i.startTime===i.endTime&&i.startTime<=e&&i.startTime+.5>=e&&t.push(i)}if(a=!1,t.length!==this.activeCues_.length)a=!0;else for(let e=0;e<t.length;e++)-1===this.activeCues_.indexOf(t[e])&&(a=!0);return this.activeCues_=t,u.setCues_(this.activeCues_),u},set(){}}}),n.src?(this.src=n.src,this.preload_||(this.loaded_=!0),(this.preload_||o||"subtitles"!==n.kind&&"captions"!==n.kind)&&d(this.src,this)):this.loaded_=!0}addCue(t){let s=t;if(e&&!(t instanceof e.VTTCue)){s=new e.VTTCue(t.startTime,t.endTime,t.text);for(const e in t)e in s||(s[e]=t[e]);s.id=t.id,s.originalCue_=t}const i=this.tech_.textTracks();for(let e=0;e<i.length;e++)i[e]!==this&&i[e].removeCue(s);this.cues_.push(s),this.cues.setCues_(this.cues_)}removeCue(e){let t=this.cues_.length;for(;t--;){const s=this.cues_[t];if(s===e||s.originalCue_&&s.originalCue_===e){this.cues_.splice(t,1),this.cues.setCues_(this.cues_);break}}}}return a.prototype.allowedEvents_={cuechange:"cuechange"},a});
//# sourceMappingURL=../sourcemaps/tracks/text-track.js.map
