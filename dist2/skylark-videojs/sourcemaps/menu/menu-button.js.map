{"version":3,"sources":["menu/menu-button.js"],"names":["define","Button","Component","Menu","Dom","Fn","Events","stringCases","browser","keycode","MenuButton","[object Object]","player","options","super","this","menuButton_","controlText","controlText_","el_","setAttribute","buttonClass","prototype","buildCSSClass","className","removeClass","addChild","update","enabled_","on","handleClick","handleKeyDown","addClass","menu","show","document","bind","handleMenuKeyUp","handleMouseLeave","handleSubmenuKeyDown","createMenu","dispose","removeChild","buttonPressed_","items","length","hideThreshold_","hide","player_","menuButton","options_","title","titleEl","createEl","innerHTML","toTitleCase","tabIndex","titleComponent","el","addItem","createItems","i","buildWrapperCSSClass","menuButtonClass","inline","text","event","unpressButton","pressButton","off","focus","blur","isEventKey","preventDefault","lockShowing","IS_IOS","isInFrame","unlockShowing","disable","enable","registerComponent"],"mappings":"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","file":"../../menu/menu-button.js","sourcesContent":["define([\n    '../button',\n    '../component',\n    './menu',\n    '../utils/dom',\n    '../utils/fn',\n    '../utils/events',\n    '../utils/string-cases',\n    '../utils/browser',\n    '../utils/keycode'\n], function (Button, Component, Menu, Dom, Fn, Events, stringCases, browser, keycode) {\n    'use strict';\n    class MenuButton extends Component {\n        constructor(player, options = {}) {\n            super(player, options);\n            this.menuButton_ = new Button(player, options);\n            this.menuButton_.controlText(this.controlText_);\n            this.menuButton_.el_.setAttribute('aria-haspopup', 'true');\n            const buttonClass = Button.prototype.buildCSSClass();\n            this.menuButton_.el_.className = this.buildCSSClass() + ' ' + buttonClass;\n            this.menuButton_.removeClass('vjs-control');\n            this.addChild(this.menuButton_);\n            this.update();\n            this.enabled_ = true;\n            this.on(this.menuButton_, 'tap', this.handleClick);\n            this.on(this.menuButton_, 'click', this.handleClick);\n            this.on(this.menuButton_, 'keydown', this.handleKeyDown);\n            this.on(this.menuButton_, 'mouseenter', () => {\n                this.addClass('vjs-hover');\n                this.menu.show();\n                Events.on(document, 'keyup', Fn.bind(this, this.handleMenuKeyUp));\n            });\n            this.on('mouseleave', this.handleMouseLeave);\n            this.on('keydown', this.handleSubmenuKeyDown);\n        }\n        update() {\n            const menu = this.createMenu();\n            if (this.menu) {\n                this.menu.dispose();\n                this.removeChild(this.menu);\n            }\n            this.menu = menu;\n            this.addChild(menu);\n            this.buttonPressed_ = false;\n            this.menuButton_.el_.setAttribute('aria-expanded', 'false');\n            if (this.items && this.items.length <= this.hideThreshold_) {\n                this.hide();\n            } else {\n                this.show();\n            }\n        }\n        createMenu() {\n            const menu = new Menu(this.player_, { menuButton: this });\n            this.hideThreshold_ = 0;\n            if (this.options_.title) {\n                const titleEl = Dom.createEl('li', {\n                    className: 'vjs-menu-title',\n                    innerHTML: stringCases.toTitleCase(this.options_.title),\n                    tabIndex: -1\n                });\n                this.hideThreshold_ += 1;\n                const titleComponent = new Component(this.player_, { el: titleEl });\n                menu.addItem(titleComponent);\n            }\n            this.items = this.createItems();\n            if (this.items) {\n                for (let i = 0; i < this.items.length; i++) {\n                    menu.addItem(this.items[i]);\n                }\n            }\n            return menu;\n        }\n        createItems() {\n        }\n        createEl() {\n            return super.createEl('div', { className: this.buildWrapperCSSClass() }, {});\n        }\n        buildWrapperCSSClass() {\n            let menuButtonClass = 'vjs-menu-button';\n            if (this.options_.inline === true) {\n                menuButtonClass += '-inline';\n            } else {\n                menuButtonClass += '-popup';\n            }\n            const buttonClass = Button.prototype.buildCSSClass();\n            return `vjs-menu-button ${ menuButtonClass } ${ buttonClass } ${ super.buildCSSClass() }`;\n        }\n        buildCSSClass() {\n            let menuButtonClass = 'vjs-menu-button';\n            if (this.options_.inline === true) {\n                menuButtonClass += '-inline';\n            } else {\n                menuButtonClass += '-popup';\n            }\n            return `vjs-menu-button ${ menuButtonClass } ${ super.buildCSSClass() }`;\n        }\n        controlText(text, el = this.menuButton_.el()) {\n            return this.menuButton_.controlText(text, el);\n        }\n        dispose() {\n            this.handleMouseLeave();\n            super.dispose();\n        }\n        handleClick(event) {\n            if (this.buttonPressed_) {\n                this.unpressButton();\n            } else {\n                this.pressButton();\n            }\n        }\n        handleMouseLeave(event) {\n            this.removeClass('vjs-hover');\n            Events.off(document, 'keyup', Fn.bind(this, this.handleMenuKeyUp));\n        }\n        focus() {\n            this.menuButton_.focus();\n        }\n        blur() {\n            this.menuButton_.blur();\n        }\n        handleKeyDown(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                if (this.buttonPressed_) {\n                    this.unpressButton();\n                }\n                if (!keycode.isEventKey(event, 'Tab')) {\n                    event.preventDefault();\n                    this.menuButton_.focus();\n                }\n            } else if (keycode.isEventKey(event, 'Up') || keycode.isEventKey(event, 'Down')) {\n                if (!this.buttonPressed_) {\n                    event.preventDefault();\n                    this.pressButton();\n                }\n            }\n        }\n        handleMenuKeyUp(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                this.removeClass('vjs-hover');\n            }\n        }\n        handleSubmenuKeyPress(event) {\n            this.handleSubmenuKeyDown(event);\n        }\n        handleSubmenuKeyDown(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                if (this.buttonPressed_) {\n                    this.unpressButton();\n                }\n                if (!keycode.isEventKey(event, 'Tab')) {\n                    event.preventDefault();\n                    this.menuButton_.focus();\n                }\n            } else {\n            }\n        }\n        pressButton() {\n            if (this.enabled_) {\n                this.buttonPressed_ = true;\n                this.menu.show();\n                this.menu.lockShowing();\n                this.menuButton_.el_.setAttribute('aria-expanded', 'true');\n                if (browser.IS_IOS && Dom.isInFrame()) {\n                    return;\n                }\n                this.menu.focus();\n            }\n        }\n        unpressButton() {\n            if (this.enabled_) {\n                this.buttonPressed_ = false;\n                this.menu.unlockShowing();\n                this.menu.hide();\n                this.menuButton_.el_.setAttribute('aria-expanded', 'false');\n            }\n        }\n        disable() {\n            this.unpressButton();\n            this.enabled_ = false;\n            this.addClass('vjs-disabled');\n            this.menuButton_.disable();\n        }\n        enable() {\n            this.enabled_ = true;\n            this.removeClass('vjs-disabled');\n            this.menuButton_.enable();\n        }\n    }\n    Component.registerComponent('MenuButton', MenuButton);\n    return MenuButton;\n});"]}