/**
 * skylark-videojs - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx","skylark-domx-eventer","skylark-widgets-base/Widget","./mixins/evented","./mixins/stateful","./utils/dom","./utils/dom-data","./utils/fn","./utils/guid","./utils/string-cases","./utils/merge-options","./utils/computed-style","./utils/map","./utils/set"],function(e,t,i,s,n,r,o,h,l,a,d,c,u,_){"use strict";class p extends i{on(e,i,s,n,r,o){this.el_&&t.isNativeEvent(e)?t.on(this.el_,e,i,s,n,r,o):super.on(e,i,s,n,r,o)}off(e,i){this.el_&&t.isNativeEvent(e)?t.off(this.el_,e,i):super.off(e,i)}listenTo(i,s,n,r){e.isString(i)||e.isArray(i)?(r=n,n=s,s=i,this.el_&&t.isNativeEvent(s)?t.on(this.el_,s,n,this,r):this.on(s,n,this,r)):i.nodeType?t.on(i,s,n,this,r):super.listenTo(i,s,n,r)}unlistenTo(i,s,n){e.isString(i)||e.isArray(i)?(n=s,s=i,this.el_&&t.isNativeEvent(s)?t.off(this.el_,s,n):this.off(s,n)):i.nodeType?t.off(i,s,n):super.unlistenTo(i,s,n)}_create(){}_construct(e,t,i){if(!e&&this.play?this.player_=e=this:this.player_=e,this.isDisposed_=!1,this.parentComponent_=null,this.options_=d({},this.options_),t=this.options_=d(this.options_,t),this.id_=t.id||t.el&&t.el.id,!this.id_){const t=e&&e.id&&e.id()||"no_player";this.id_=`${t}_component_${l.newGUID()}`}this.name_=t.name||null,t.el?this.el_=t.el:!1!==t.createEl&&(this.el_=this.createEl()),!1!==t.evented&&(this.handleLanguagechange=this.handleLanguagechange.bind(this),this.listenTo(this.player_,"languagechange",this.handleLanguagechange)),n(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new _,this.setIntervalIds_=new _,this.rafIds_=new _,this.namedRafs_=new u,this.clearingTimersOnDispose_=!1,!1!==t.initChildren&&this.initChildren(),this.ready(i),!1!==t.reportTouchActivity&&this.enableTouchActivity()}dispose(){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(let e=this.children_.length-1;e>=0;e--)this.children_[e].dispose&&this.children_[e].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),t.clear(this.el_),this.el_=null),this.player_=null}}isDisposed(){return Boolean(this.isDisposed_)}player(){return this.player_}options(e){return e?(this.options_=d(this.options_,e),this.options_):this.options_}el(){return this.el_}createEl(e,t,i){return r.createEl(e,t,i)}localize(e,t,i=e){const s=this.player_.language&&this.player_.language(),n=this.player_.languages&&this.player_.languages(),r=n&&n[s],o=s&&s.split("-")[0],h=n&&n[o];let l=i;return r&&r[e]?l=r[e]:h&&h[e]&&(l=h[e]),t&&(l=l.replace(/\{(\d+)\}/g,function(e,i){const s=t[i-1];let n=s;return void 0===s&&(n=e),n})),l}handleLanguagechange(){}contentEl(){return this.contentEl_||this.el_}id(){return this.id_}name(){return this.name_}children(){return this.children_}getChildById(e){return this.childIndex_[e]}getChild(e){if(e)return this.childNameIndex_[e]}getDescendant(...e){e=e.reduce((e,t)=>e.concat(t),[]);let t=this;for(let i=0;i<e.length;i++)if(!(t=t.getChild(e[i]))||!t.getChild)return;return t}addChild(e,t={},i=this.children_.length){let s,n;if("string"==typeof e){n=a.toTitleCase(e);const i=t.componentClass||n;t.name=n;const r=p.getComponent(i);if(!r)throw new Error(`Component ${i} does not exist`);if("function"!=typeof r)return null;s=new r(this.player_||this,t)}else s=e;if(s.parentComponent_&&s.parentComponent_.removeChild(s),this.children_.splice(i,0,s),s.parentComponent_=this,"function"==typeof s.id&&(this.childIndex_[s.id()]=s),(n=n||s.name&&a.toTitleCase(s.name()))&&(this.childNameIndex_[n]=s,this.childNameIndex_[a.toLowerCase(n)]=s),"function"==typeof s.el&&s.el()){let e=null;this.children_[i+1]&&(this.children_[i+1].el_?e=this.children_[i+1].el_:r.isEl(this.children_[i+1])&&(e=this.children_[i+1])),this.contentEl().insertBefore(s.el(),e)}return s}removeChild(e){if("string"==typeof e&&(e=this.getChild(e)),!e||!this.children_)return;let t=!1;for(let i=this.children_.length-1;i>=0;i--)if(this.children_[i]===e){t=!0,this.children_.splice(i,1);break}if(!t)return;e.parentComponent_=null,this.childIndex_[e.id()]=null,this.childNameIndex_[a.toTitleCase(e.name())]=null,this.childNameIndex_[a.toLowerCase(e.name())]=null;const i=e.el();i&&i.parentNode===this.contentEl()&&this.contentEl().removeChild(e.el())}initChildren(){const e=this.options_.children;if(e){const t=this.options_,i=e=>{const i=e.name;let s=e.opts;if(void 0!==t[i]&&(s=t[i]),!1===s)return;!0===s&&(s={}),s.playerOptions=this.options_.playerOptions;const n=this.addChild(i,s);n&&(this[i]=n)};let s;const n=p.getComponent("Tech");(s=Array.isArray(e)?e:Object.keys(e)).concat(Object.keys(this.options_).filter(function(e){return!s.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(t=>{let i,s;return"string"==typeof t?s=e[i=t]||this.options_[i]||{}:(i=t.name,s=t),{name:i,opts:s}}).filter(e=>{const t=p.getComponent(e.opts.componentClass||a.toTitleCase(e.name));return t&&!n.isTech(t)}).forEach(i)}}buildCSSClass(){return""}ready(e,t=!1){if(e)return this.isReady_?void(t?e.call(this):this.setTimeout(e,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(e))}triggerReady(){this.isReady_=!0,this.setTimeout(function(){const e=this.readyQueue_;this.readyQueue_=[],e&&e.length>0&&e.forEach(function(e){e.call(this)},this),this.trigger("ready")},1)}$(e,t){return r.$(e,t||this.contentEl())}$$(e,t){return r.$$(e,t||this.contentEl())}hasClass(e){return r.hasClass(this.el_,e)}addClass(e){r.addClass(this.el_,e)}removeClass(e){r.removeClass(this.el_,e)}toggleClass(e,t){r.toggleClass(this.el_,e,t)}show(){this.removeClass("vjs-hidden")}hide(){this.addClass("vjs-hidden")}lockShowing(){this.addClass("vjs-lock-showing")}unlockShowing(){this.removeClass("vjs-lock-showing")}getAttribute(e){return r.getAttribute(this.el_,e)}setAttribute(e,t){r.setAttribute(this.el_,e,t)}removeAttribute(e){r.removeAttribute(this.el_,e)}width(e,t){return this.dimension("width",e,t)}height(e,t){return this.dimension("height",e,t)}dimensions(e,t){this.width(e,!0),this.height(t)}dimension(e,t,i){if(void 0!==t)return null!==t&&t==t||(t=0),-1!==(""+t).indexOf("%")||-1!==(""+t).indexOf("px")?this.el_.style[e]=t:this.el_.style[e]="auto"===t?"":t+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;const s=this.el_.style[e],n=s.indexOf("px");return-1!==n?parseInt(s.slice(0,n),10):parseInt(this.el_["offset"+a.toTitleCase(e)],10)}currentDimension(e){let t=0;if("width"!==e&&"height"!==e)throw new Error("currentDimension only accepts width or height value");if(t=c(this.el_,e),0===(t=parseFloat(t))||isNaN(t)){const i=`offset${a.toTitleCase(e)}`;t=this.el_[i]}return t}currentDimensions(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}}currentWidth(){return this.currentDimension("width")}currentHeight(){return this.currentDimension("height")}focus(){this.el_.focus()}blur(){this.el_.blur()}handleKeyDown(e){this.player_&&(e.stopPropagation(),this.player_.handleKeyDown(e))}handleKeyPress(e){this.handleKeyDown(e)}emitTapEvents(){let e=0,t=null;let i;this.listenTo("touchstart",function(s){1===s.touches.length&&(t={pageX:s.touches[0].pageX,pageY:s.touches[0].pageY},e=window.performance.now(),i=!0)}),this.listenTo("touchmove",function(e){if(e.touches.length>1)i=!1;else if(t){const s=e.touches[0].pageX-t.pageX,n=e.touches[0].pageY-t.pageY;Math.sqrt(s*s+n*n)>10&&(i=!1)}});const s=function(){i=!1};this.listenTo("touchleave",s),this.listenTo("touchcancel",s),this.listenTo("touchend",function(s){if(t=null,!0===i){window.performance.now()-e<200&&(s.preventDefault(),this.trigger("tap"))}})}enableTouchActivity(){if(!this.player()||!this.player().reportUserActivity)return;const e=h.bind(this.player(),this.player().reportUserActivity);let t;this.listenTo("touchstart",function(){e(),this.clearInterval(t),t=this.setInterval(e,250)});const i=function(i){e(),this.clearInterval(t)};this.listenTo("touchmove",e),this.listenTo("touchend",i),this.listenTo("touchcancel",i)}setTimeout(e,t){var i;return e=h.bind(this,e),this.clearTimersOnDispose_(),i=window.setTimeout(()=>{this.setTimeoutIds_.has(i)&&this.setTimeoutIds_.delete(i),e()},t),this.setTimeoutIds_.add(i),i}clearTimeout(e){return this.setTimeoutIds_.has(e)&&(this.setTimeoutIds_.delete(e),window.clearTimeout(e)),e}setInterval(e,t){e=h.bind(this,e),this.clearTimersOnDispose_();const i=window.setInterval(e,t);return this.setIntervalIds_.add(i),i}clearInterval(e){return this.setIntervalIds_.has(e)&&(this.setIntervalIds_.delete(e),window.clearInterval(e)),e}requestAnimationFrame(e){return this.supportsRaf_?(this.clearTimersOnDispose_(),e=h.bind(this,e),t=window.requestAnimationFrame(()=>{this.rafIds_.has(t)&&this.rafIds_.delete(t),e()}),this.rafIds_.add(t),t):this.setTimeout(e,1e3/60);var t}requestNamedAnimationFrame(e,t){if(this.namedRafs_.has(e))return;this.clearTimersOnDispose_(),t=h.bind(this,t);const i=this.requestAnimationFrame(()=>{t(),this.namedRafs_.has(e)&&this.namedRafs_.delete(e)});return this.namedRafs_.set(e,i),e}cancelNamedAnimationFrame(e){this.namedRafs_.has(e)&&(this.cancelAnimationFrame(this.namedRafs_.get(e)),this.namedRafs_.delete(e))}cancelAnimationFrame(e){return this.supportsRaf_?(this.rafIds_.has(e)&&(this.rafIds_.delete(e),window.cancelAnimationFrame(e)),e):this.clearTimeout(e)}clearTimersOnDispose_(){this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.listenToOnce("dispose",()=>{[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(([e,t])=>{this[e].forEach((e,i)=>this[t](i))}),this.clearingTimersOnDispose_=!1}))}static registerComponent(e,t){if("string"!=typeof e||!e)throw new Error(`Illegal component name, "${e}"; must be a non-empty string.`);const i=p.getComponent("Tech"),s=i&&i.isTech(t),n=p===t||p.prototype.isPrototypeOf(t.prototype);if(s||!n){let t;throw t=s?"techs must be registered using Tech.registerTech()":"must be a Component subclass",new Error(`Illegal component, "${e}"; ${t}.`)}e=a.toTitleCase(e),p.components_||(p.components_={});const r=p.getComponent("Player");if("Player"===e&&r&&r.players){const e=r.players,t=Object.keys(e);if(e&&t.length>0&&t.map(t=>e[t]).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return p.components_[e]=t,p.components_[a.toLowerCase(e)]=t,t}static getComponent(e){if(e&&p.components_)return p.components_[e]}}return p.prototype.supportsRaf_="function"==typeof window.requestAnimationFrame&&"function"==typeof window.cancelAnimationFrame,p.registerComponent("Component",p),p});
//# sourceMappingURL=sourcemaps/component.js.map
