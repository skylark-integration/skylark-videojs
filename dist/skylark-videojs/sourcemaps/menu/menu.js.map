{"version":3,"sources":["menu/menu.js"],"names":["define","document","Component","Dom","Fn","Events","keycode","Menu","[object Object]","player","options","super","this","menuButton_","menuButton","focusedChild_","on","handleKeyDown","boundHandleBlur_","bind","handleBlur","boundHandleTapClick_","handleTapClick","component","off","getChild","removeEventListenerForItem","removeChild","childComponent","addChild","addEventListenerForItem","contentElType","options_","contentEl_","createEl","className","setAttribute","el","append","appendChild","event","preventDefault","stopImmediatePropagation","dispose","relatedTarget","activeElement","children","some","element","btn","buttonPressed_","firstChild","unpressButton","childComponents","Array","isArray","foundComponent","filter","target","name","focus","isEventKey","stopPropagation","stepForward","stepBack","stepChild","undefined","item","slice","length","hasClass","shift","el_","registerComponent"],"mappings":"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","file":"../../menu/menu.js","sourcesContent":["define([\n    'skylark-langx-globals/document',\n    '../component',\n    '../utils/dom',\n    '../utils/fn',\n    '../utils/events',\n    '../utils/keycode'\n], function (document,Component, Dom, Fn, Events, keycode) {\n    'use strict';\n    class Menu extends Component {\n        constructor(player, options) {\n            super(player, options);\n            if (options) {\n                this.menuButton_ = options.menuButton;\n            }\n            this.focusedChild_ = -1;\n            this.on('keydown', this.handleKeyDown);\n            this.boundHandleBlur_ = Fn.bind(this, this.handleBlur);\n            this.boundHandleTapClick_ = Fn.bind(this, this.handleTapClick);\n        }\n        addEventListenerForItem(component) {\n            if (!(component instanceof Component)) {\n                return;\n            }\n            this.on(component, 'blur', this.boundHandleBlur_);\n            this.on(component, [\n                'tap',\n                'click'\n            ], this.boundHandleTapClick_);\n        }\n        removeEventListenerForItem(component) {\n            if (!(component instanceof Component)) {\n                return;\n            }\n            this.off(component, 'blur', this.boundHandleBlur_);\n            this.off(component, [\n                'tap',\n                'click'\n            ], this.boundHandleTapClick_);\n        }\n        removeChild(component) {\n            if (typeof component === 'string') {\n                component = this.getChild(component);\n            }\n            this.removeEventListenerForItem(component);\n            super.removeChild(component);\n        }\n        addItem(component) {\n            const childComponent = this.addChild(component);\n            if (childComponent) {\n                this.addEventListenerForItem(childComponent);\n            }\n        }\n        createEl() {\n            const contentElType = this.options_.contentElType || 'ul';\n            this.contentEl_ = Dom.createEl(contentElType, { className: 'vjs-menu-content' });\n            this.contentEl_.setAttribute('role', 'menu');\n            const el = super.createEl('div', {\n                append: this.contentEl_,\n                className: 'vjs-menu'\n            });\n            el.appendChild(this.contentEl_);\n            Events.on(el, 'click', function (event) {\n                event.preventDefault();\n                event.stopImmediatePropagation();\n            });\n            return el;\n        }\n        dispose() {\n            this.contentEl_ = null;\n            this.boundHandleBlur_ = null;\n            this.boundHandleTapClick_ = null;\n            super.dispose();\n        }\n        handleBlur(event) {\n            const relatedTarget = event.relatedTarget || document.activeElement;\n            if (!this.children().some(element => {\n                    return element.el() === relatedTarget;\n                })) {\n                const btn = this.menuButton_;\n                if (btn && btn.buttonPressed_ && relatedTarget !== btn.el().firstChild) {\n                    btn.unpressButton();\n                }\n            }\n        }\n        handleTapClick(event) {\n            if (this.menuButton_) {\n                this.menuButton_.unpressButton();\n                const childComponents = this.children();\n                if (!Array.isArray(childComponents)) {\n                    return;\n                }\n                const foundComponent = childComponents.filter(component => component.el() === event.target)[0];\n                if (!foundComponent) {\n                    return;\n                }\n                if (foundComponent.name() !== 'CaptionSettingsMenuItem') {\n                    this.menuButton_.focus();\n                }\n            }\n        }\n        handleKeyDown(event) {\n            if (keycode.isEventKey(event, 'Left') || keycode.isEventKey(event, 'Down')) {\n                event.preventDefault();\n                event.stopPropagation();\n                this.stepForward();\n            } else if (keycode.isEventKey(event, 'Right') || keycode.isEventKey(event, 'Up')) {\n                event.preventDefault();\n                event.stopPropagation();\n                this.stepBack();\n            }\n        }\n        stepForward() {\n            let stepChild = 0;\n            if (this.focusedChild_ !== undefined) {\n                stepChild = this.focusedChild_ + 1;\n            }\n            this.focus(stepChild);\n        }\n        stepBack() {\n            let stepChild = 0;\n            if (this.focusedChild_ !== undefined) {\n                stepChild = this.focusedChild_ - 1;\n            }\n            this.focus(stepChild);\n        }\n        focus(item = 0) {\n            const children = this.children().slice();\n            const haveTitle = children.length && children[0].hasClass('vjs-menu-title');\n            if (haveTitle) {\n                children.shift();\n            }\n            if (children.length > 0) {\n                if (item < 0) {\n                    item = 0;\n                } else if (item >= children.length) {\n                    item = children.length - 1;\n                }\n                this.focusedChild_ = item;\n                children[item].el_.focus();\n            }\n        }\n    }\n    Component.registerComponent('Menu', Menu);\n    return Menu;\n});"]}