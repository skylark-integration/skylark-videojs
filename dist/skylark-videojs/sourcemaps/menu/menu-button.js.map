{"version":3,"sources":["menu/menu-button.js"],"names":["define","Button","Component","Menu","Dom","Fn","Events","stringCases","browser","keycode","MenuButton","[object Object]","player","options","super","this","menuButton_","controlText","controlText_","el_","setAttribute","buttonClass","prototype","buildCSSClass","className","removeClass","addChild","update","enabled_","listenTo","handleClick","handleKeyDown","addClass","menu","show","on","document","bind","handleMenuKeyUp","handleMouseLeave","handleSubmenuKeyDown","createMenu","dispose","removeChild","buttonPressed_","items","length","hideThreshold_","hide","player_","menuButton","options_","title","titleEl","createEl","innerHTML","toTitleCase","tabIndex","titleComponent","el","addItem","createItems","i","buildWrapperCSSClass","menuButtonClass","inline","text","event","unpressButton","pressButton","off","focus","blur","isEventKey","preventDefault","lockShowing","IS_IOS","isInFrame","unlockShowing","disable","enable","registerComponent"],"mappings":";;;;;;;AAAAA,QACI,YACA,eACA,SACA,eACA,cACA,kBACA,wBACA,mBACA,oBACD,SAAUC,EAAQC,EAAWC,EAAMC,EAAKC,EAAIC,EAAQC,EAAaC,EAASC,GACzE,mBACMC,UAAmBR,EACrBS,YAAYC,EAAQC,MAChBC,MAAMF,EAAQC,GACdE,KAAKC,YAAc,IAAIf,EAAOW,EAAQC,GACtCE,KAAKC,YAAYC,YAAYF,KAAKG,cAClCH,KAAKC,YAAYG,IAAIC,aAAa,gBAAiB,QACnD,MAAMC,EAAcpB,EAAOqB,UAAUC,gBACrCR,KAAKC,YAAYG,IAAIK,UAAYT,KAAKQ,gBAAkB,IAAMF,EAC9DN,KAAKC,YAAYS,YAAY,eAC7BV,KAAKW,SAASX,KAAKC,aACnBD,KAAKY,SACLZ,KAAKa,UAAW,EAChBb,KAAKc,SAASd,KAAKC,YAAa,MAAOD,KAAKe,aAC5Cf,KAAKc,SAASd,KAAKC,YAAa,QAASD,KAAKe,aAC9Cf,KAAKc,SAASd,KAAKC,YAAa,UAAWD,KAAKgB,eAChDhB,KAAKc,SAASd,KAAKC,YAAa,aAAc,KAC1CD,KAAKiB,SAAS,aACdjB,KAAKkB,KAAKC,OACV5B,EAAO6B,GAAGC,SAAU,QAAS/B,EAAGgC,KAAKtB,KAAMA,KAAKuB,oBAEpDvB,KAAKc,SAAS,aAAcd,KAAKwB,kBACjCxB,KAAKc,SAAS,UAAWd,KAAKyB,sBAElC7B,SACI,MAAMsB,EAAOlB,KAAK0B,aACd1B,KAAKkB,OACLlB,KAAKkB,KAAKS,UACV3B,KAAK4B,YAAY5B,KAAKkB,OAE1BlB,KAAKkB,KAAOA,EACZlB,KAAKW,SAASO,GACdlB,KAAK6B,gBAAiB,EACtB7B,KAAKC,YAAYG,IAAIC,aAAa,gBAAiB,SAC/CL,KAAK8B,OAAS9B,KAAK8B,MAAMC,QAAU/B,KAAKgC,eACxChC,KAAKiC,OAELjC,KAAKmB,OAGbvB,aACI,MAAMsB,EAAO,IAAI9B,EAAKY,KAAKkC,SAAWC,WAAYnC,OAElD,GADAA,KAAKgC,eAAiB,EAClBhC,KAAKoC,SAASC,MAAO,CACrB,MAAMC,EAAUjD,EAAIkD,SAAS,MACzB9B,UAAW,iBACX+B,UAAWhD,EAAYiD,YAAYzC,KAAKoC,SAASC,OACjDK,UAAW,IAEf1C,KAAKgC,gBAAkB,EACvB,MAAMW,EAAiB,IAAIxD,EAAUa,KAAKkC,SAAWU,GAAIN,IACzDpB,EAAK2B,QAAQF,GAGjB,GADA3C,KAAK8B,MAAQ9B,KAAK8C,cACd9C,KAAK8B,MACL,IAAK,IAAIiB,EAAI,EAAGA,EAAI/C,KAAK8B,MAAMC,OAAQgB,IACnC7B,EAAK2B,QAAQ7C,KAAK8B,MAAMiB,IAGhC,OAAO7B,EAEXtB,eAEAA,WACI,OAAOG,MAAMwC,SAAS,OAAS9B,UAAWT,KAAKgD,4BAEnDpD,uBACI,IAAIqD,EAAkB,kBAOtB,OAN6B,IAAzBjD,KAAKoC,SAASc,OACdD,GAAmB,UAEnBA,GAAmB,4BAGIA,KADP/D,EAAOqB,UAAUC,mBAC4BT,MAAMS,kBAE3EZ,gBACI,IAAIqD,EAAkB,kBAMtB,OAL6B,IAAzBjD,KAAKoC,SAASc,OACdD,GAAmB,UAEnBA,GAAmB,4BAEIA,KAAqBlD,MAAMS,kBAE1DZ,YAAYuD,EAAMP,EAAK5C,KAAKC,YAAY2C,MACpC,OAAO5C,KAAKC,YAAYC,YAAYiD,EAAMP,GAE9ChD,UACII,KAAKwB,mBACLzB,MAAM4B,UAEV/B,YAAYwD,GACJpD,KAAK6B,eACL7B,KAAKqD,gBAELrD,KAAKsD,cAGb1D,iBAAiBwD,GACbpD,KAAKU,YAAY,aACjBnB,EAAOgE,IAAIlC,SAAU,QAAS/B,EAAGgC,KAAKtB,KAAMA,KAAKuB,kBAErD3B,QACII,KAAKC,YAAYuD,QAErB5D,OACII,KAAKC,YAAYwD,OAErB7D,cAAcwD,GACN1D,EAAQgE,WAAWN,EAAO,QAAU1D,EAAQgE,WAAWN,EAAO,QAC1DpD,KAAK6B,gBACL7B,KAAKqD,gBAEJ3D,EAAQgE,WAAWN,EAAO,SAC3BA,EAAMO,iBACN3D,KAAKC,YAAYuD,WAEd9D,EAAQgE,WAAWN,EAAO,OAAS1D,EAAQgE,WAAWN,EAAO,WAC/DpD,KAAK6B,iBACNuB,EAAMO,iBACN3D,KAAKsD,gBAIjB1D,gBAAgBwD,IACR1D,EAAQgE,WAAWN,EAAO,QAAU1D,EAAQgE,WAAWN,EAAO,SAC9DpD,KAAKU,YAAY,aAGzBd,sBAAsBwD,GAClBpD,KAAKyB,qBAAqB2B,GAE9BxD,qBAAqBwD,IACb1D,EAAQgE,WAAWN,EAAO,QAAU1D,EAAQgE,WAAWN,EAAO,UAC1DpD,KAAK6B,gBACL7B,KAAKqD,gBAEJ3D,EAAQgE,WAAWN,EAAO,SAC3BA,EAAMO,iBACN3D,KAAKC,YAAYuD,UAK7B5D,cACI,GAAII,KAAKa,SAAU,CAKf,GAJAb,KAAK6B,gBAAiB,EACtB7B,KAAKkB,KAAKC,OACVnB,KAAKkB,KAAK0C,cACV5D,KAAKC,YAAYG,IAAIC,aAAa,gBAAiB,QAC/CZ,EAAQoE,QAAUxE,EAAIyE,YACtB,OAEJ9D,KAAKkB,KAAKsC,SAGlB5D,gBACQI,KAAKa,WACLb,KAAK6B,gBAAiB,EACtB7B,KAAKkB,KAAK6C,gBACV/D,KAAKkB,KAAKe,OACVjC,KAAKC,YAAYG,IAAIC,aAAa,gBAAiB,UAG3DT,UACII,KAAKqD,gBACLrD,KAAKa,UAAW,EAChBb,KAAKiB,SAAS,gBACdjB,KAAKC,YAAY+D,UAErBpE,SACII,KAAKa,UAAW,EAChBb,KAAKU,YAAY,gBACjBV,KAAKC,YAAYgE,UAIzB,OADA9E,EAAU+E,kBAAkB,aAAcvE,GACnCA","file":"../../menu/menu-button.js","sourcesContent":["define([\n    '../button',\n    '../component',\n    './menu',\n    '../utils/dom',\n    '../utils/fn',\n    '../utils/events',\n    '../utils/string-cases',\n    '../utils/browser',\n    '../utils/keycode'\n], function (Button, Component, Menu, Dom, Fn, Events, stringCases, browser, keycode) {\n    'use strict';\n    class MenuButton extends Component {\n        constructor(player, options = {}) {\n            super(player, options);\n            this.menuButton_ = new Button(player, options);\n            this.menuButton_.controlText(this.controlText_);\n            this.menuButton_.el_.setAttribute('aria-haspopup', 'true');\n            const buttonClass = Button.prototype.buildCSSClass();\n            this.menuButton_.el_.className = this.buildCSSClass() + ' ' + buttonClass;\n            this.menuButton_.removeClass('vjs-control');\n            this.addChild(this.menuButton_);\n            this.update();\n            this.enabled_ = true;\n            this.listenTo(this.menuButton_, 'tap', this.handleClick);\n            this.listenTo(this.menuButton_, 'click', this.handleClick);\n            this.listenTo(this.menuButton_, 'keydown', this.handleKeyDown);\n            this.listenTo(this.menuButton_, 'mouseenter', () => {\n                this.addClass('vjs-hover');\n                this.menu.show();\n                Events.on(document, 'keyup', Fn.bind(this, this.handleMenuKeyUp));\n            });\n            this.listenTo('mouseleave', this.handleMouseLeave);\n            this.listenTo('keydown', this.handleSubmenuKeyDown);\n        }\n        update() {\n            const menu = this.createMenu();\n            if (this.menu) {\n                this.menu.dispose();\n                this.removeChild(this.menu);\n            }\n            this.menu = menu;\n            this.addChild(menu);\n            this.buttonPressed_ = false;\n            this.menuButton_.el_.setAttribute('aria-expanded', 'false');\n            if (this.items && this.items.length <= this.hideThreshold_) {\n                this.hide();\n            } else {\n                this.show();\n            }\n        }\n        createMenu() {\n            const menu = new Menu(this.player_, { menuButton: this });\n            this.hideThreshold_ = 0;\n            if (this.options_.title) {\n                const titleEl = Dom.createEl('li', {\n                    className: 'vjs-menu-title',\n                    innerHTML: stringCases.toTitleCase(this.options_.title),\n                    tabIndex: -1\n                });\n                this.hideThreshold_ += 1;\n                const titleComponent = new Component(this.player_, { el: titleEl });\n                menu.addItem(titleComponent);\n            }\n            this.items = this.createItems();\n            if (this.items) {\n                for (let i = 0; i < this.items.length; i++) {\n                    menu.addItem(this.items[i]);\n                }\n            }\n            return menu;\n        }\n        createItems() {\n        }\n        createEl() {\n            return super.createEl('div', { className: this.buildWrapperCSSClass() }, {});\n        }\n        buildWrapperCSSClass() {\n            let menuButtonClass = 'vjs-menu-button';\n            if (this.options_.inline === true) {\n                menuButtonClass += '-inline';\n            } else {\n                menuButtonClass += '-popup';\n            }\n            const buttonClass = Button.prototype.buildCSSClass();\n            return `vjs-menu-button ${ menuButtonClass } ${ buttonClass } ${ super.buildCSSClass() }`;\n        }\n        buildCSSClass() {\n            let menuButtonClass = 'vjs-menu-button';\n            if (this.options_.inline === true) {\n                menuButtonClass += '-inline';\n            } else {\n                menuButtonClass += '-popup';\n            }\n            return `vjs-menu-button ${ menuButtonClass } ${ super.buildCSSClass() }`;\n        }\n        controlText(text, el = this.menuButton_.el()) {\n            return this.menuButton_.controlText(text, el);\n        }\n        dispose() {\n            this.handleMouseLeave();\n            super.dispose();\n        }\n        handleClick(event) {\n            if (this.buttonPressed_) {\n                this.unpressButton();\n            } else {\n                this.pressButton();\n            }\n        }\n        handleMouseLeave(event) {\n            this.removeClass('vjs-hover');\n            Events.off(document, 'keyup', Fn.bind(this, this.handleMenuKeyUp));\n        }\n        focus() {\n            this.menuButton_.focus();\n        }\n        blur() {\n            this.menuButton_.blur();\n        }\n        handleKeyDown(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                if (this.buttonPressed_) {\n                    this.unpressButton();\n                }\n                if (!keycode.isEventKey(event, 'Tab')) {\n                    event.preventDefault();\n                    this.menuButton_.focus();\n                }\n            } else if (keycode.isEventKey(event, 'Up') || keycode.isEventKey(event, 'Down')) {\n                if (!this.buttonPressed_) {\n                    event.preventDefault();\n                    this.pressButton();\n                }\n            }\n        }\n        handleMenuKeyUp(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                this.removeClass('vjs-hover');\n            }\n        }\n        handleSubmenuKeyPress(event) {\n            this.handleSubmenuKeyDown(event);\n        }\n        handleSubmenuKeyDown(event) {\n            if (keycode.isEventKey(event, 'Esc') || keycode.isEventKey(event, 'Tab')) {\n                if (this.buttonPressed_) {\n                    this.unpressButton();\n                }\n                if (!keycode.isEventKey(event, 'Tab')) {\n                    event.preventDefault();\n                    this.menuButton_.focus();\n                }\n            } else {\n            }\n        }\n        pressButton() {\n            if (this.enabled_) {\n                this.buttonPressed_ = true;\n                this.menu.show();\n                this.menu.lockShowing();\n                this.menuButton_.el_.setAttribute('aria-expanded', 'true');\n                if (browser.IS_IOS && Dom.isInFrame()) {\n                    return;\n                }\n                this.menu.focus();\n            }\n        }\n        unpressButton() {\n            if (this.enabled_) {\n                this.buttonPressed_ = false;\n                this.menu.unlockShowing();\n                this.menu.hide();\n                this.menuButton_.el_.setAttribute('aria-expanded', 'false');\n            }\n        }\n        disable() {\n            this.unpressButton();\n            this.enabled_ = false;\n            this.addClass('vjs-disabled');\n            this.menuButton_.disable();\n        }\n        enable() {\n            this.enabled_ = true;\n            this.removeClass('vjs-disabled');\n            this.menuButton_.enable();\n        }\n    }\n    Component.registerComponent('MenuButton', MenuButton);\n    return MenuButton;\n});"]}