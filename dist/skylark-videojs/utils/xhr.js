/**
 * skylark-videojs - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-globals/window","skylark-langx-objects","skylark-langx-types","skylark-net-http/xhr"],function(e,t,r,n){"use strict";var o=function(e){var t={};return e?(e.trim().split("\n").forEach(function(e){var r=e.indexOf(":"),n=e.slice(0,r).trim().toLowerCase(),o=e.slice(r+1).trim();void 0===t[n]?t[n]=o:Array.isArray(t[n])?t[n].push(o):t[n]=[t[n],o]}),t):t};function s(e,n,o){var s=e;return r.isFunction(n)?(o=n,"string"==typeof e&&(s={uri:e})):s=t.mixin({},n,{uri:e}),s.callback=o,s}function a(e,t,r){return i(t=s(e,t,r))}function i(e){if(void 0===e.callback)throw new Error("callback argument missing");var t=!1,r=function(r,n,o){t||(t=!0,e.callback(r,n,o))};function n(e){return clearTimeout(p),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,r(e,w)}function s(){if(!u){var t;clearTimeout(p),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var n=w,s=null;return 0!==t?(n={body:function(){var e=void 0;if(e=c.response?c.response:c.responseText||function(e){try{if("document"===e.responseType)return e.responseXML;var t=e.responseXML&&"parsererror"===e.responseXML.documentElement.nodeName;if(""===e.responseType&&!t)return e.responseXML}catch(e){}return null}(c),y)try{e=JSON.parse(e)}catch(e){}return e}(),statusCode:t,method:l,headers:{},url:d,rawRequest:c},c.getAllResponseHeaders&&(n.headers=o(c.getAllResponseHeaders()))):s=new Error("Internal XMLHttpRequest Error"),r(s,n,n.body)}}var i,u,c=e.xhr||null;c||(c=e.cors||e.useXDR?new a.XDomainRequest:new a.XMLHttpRequest);var p,d=c.url=e.uri||e.url,l=c.method=e.method||"GET",f=e.body||e.data,h=c.headers=e.headers||{},m=!!e.sync,y=!1,w={body:void 0,headers:{},statusCode:0,method:l,url:d,rawRequest:c};if("json"in e&&!1!==e.json&&(y=!0,h.accept||h.Accept||(h.Accept="application/json"),"GET"!==l&&"HEAD"!==l&&(h["content-type"]||h["Content-Type"]||(h["Content-Type"]="application/json"),f=JSON.stringify(!0===e.json?f:e.json))),c.onreadystatechange=function(){4===c.readyState&&setTimeout(s,0)},c.onload=s,c.onerror=n,c.onprogress=function(){},c.onabort=function(){u=!0},c.ontimeout=n,c.open(l,d,!m,e.username,e.password),m||(c.withCredentials=!!e.withCredentials),!m&&e.timeout>0&&(p=setTimeout(function(){if(!u){u=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",n(e)}},e.timeout)),c.setRequestHeader)for(i in h)h.hasOwnProperty(i)&&c.setRequestHeader(i,h[i]);else if(e.headers&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(f||null),c}return a.XMLHttpRequest=e.XMLHttpRequest||function(){},a.XDomainRequest="withCredentials"in new a.XMLHttpRequest?a.XMLHttpRequest:e.XDomainRequest,function(e,t){for(var r=0;r<e.length;r++)t(e[r])}(["get","put","post","patch","head","delete"],function(e){a["delete"===e?"del":e]=function(t,r,n){return(r=s(t,r,n)).method=e.toUpperCase(),i(r)}}),a});
//# sourceMappingURL=../sourcemaps/utils/xhr.js.map
