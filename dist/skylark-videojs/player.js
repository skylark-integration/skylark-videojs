/**
 * skylark-videojs - A version of video.js that ported to running on skylarkjs.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-globals/document","./component","./mixins/evented","./utils/events","./utils/dom","./utils/fn","./utils/guid","./utils/browser","./utils/log","./utils/string-cases","./utils/time-ranges","./utils/buffer","./utils/stylesheet","./fullscreen-api","./media-error","./utils/safeParseTuple","./utils/obj","./utils/merge-options","./utils/promise","./tracks/text-track-list-converter","./modal-dialog","./tech/tech","./tech/middleware","./tracks/track-types","./utils/filter-source","./utils/mimetypes","./utils/keycode","./tech/loader","./poster-image","./tracks/text-track-display","./loading-spinner","./big-play-button","./close-button","./control-bar/control-bar","./error-display","./tracks/text-track-settings","./resize-manager","./live-tracker","./tech/html5"],function(t,e,s,i,r,h,n,o,a,l,c,u,d,_,p,g,y,v,f,m,T,C,b,k,P,w,S){"use strict";const A=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],E={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},j=["tiny","xsmall","small","medium","large","xlarge","huge"],F={};j.forEach(t=>{const e="x"===t.charAt(0)?`x-${t.substring(1)}`:t;F[t]=`vjs-layout-${e}`});const I={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0};class x extends e{constructor(e,s,h){if(e.id=e.id||s.id||`vjs_video_${n.newGUID()}`,(s=y.assign(x.getTagSettings(e),s)).initChildren=!1,s.createEl=!1,s.evented=!1,s.reportTouchActivity=!1,!s.language)if("function"==typeof e.closest){const t=e.closest("[lang]");t&&t.getAttribute&&(s.language=t.getAttribute("lang"))}else{let t=e;for(;t&&1===t.nodeType;){if(r.getAttributes(t).hasOwnProperty("lang")){s.language=t.getAttribute("lang");break}t=t.parentNode}}if(super(null,s,h),this.boundDocumentFullscreenChange_=(t=>this.documentFullscreenChange_(t)),this.boundFullWindowOnEscKey_=(t=>this.fullWindowOnEscKey(t)),this.isFullscreen_=!1,this.log=a.createLogger(this.id_),this.fsApi_=_,this.isPosterFromTech_=!1,this.queuedCallbacks_=[],this.isReady_=!1,this.hasStarted_=!1,this.userActive_=!1,this.debugEnabled_=!1,!this.options_||!this.options_.techOrder||!this.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");if(this.tag=e,this.tagAttributes=e&&r.getAttributes(e),this.language(this.options_.language),s.languages){const t={};Object.getOwnPropertyNames(s.languages).forEach(function(e){t[e.toLowerCase()]=s.languages[e]}),this.languages_=t}else this.languages_=x.prototype.options_.languages;this.resetCache_(),this.poster_=s.poster||"",this.controls_=!!s.controls,e.controls=!1,e.removeAttribute("controls"),this.changingSrc_=!1,this.playCallbacks_=[],this.playTerminatedQueue_=[],e.hasAttribute("autoplay")?this.autoplay(!0):this.autoplay(this.options_.autoplay),s.plugins&&Object.keys(s.plugins).forEach(t=>{if("function"!=typeof this[t])throw new Error(`plugin "${t}" does not exist`)}),this.scrubbing_=!1,this.el_=this.createEl(),this.fsApi_.requestFullscreen&&(i.on(t,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),this.listenTo(this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_)),this.fluid_&&this.listenTo(["playerreset","resize"],this.updateStyleEl_);const l=v(this.options_);s.plugins&&Object.keys(s.plugins).forEach(t=>{this[t](s.plugins[t])}),s.debug&&this.debug(!0),this.options_.playerOptions=l,this.middleware_=[],this.initChildren(),this.isAudio("audio"===e.nodeName.toLowerCase()),this.controls()?this.addClass("vjs-controls-enabled"):this.addClass("vjs-controls-disabled"),this.el_.setAttribute("role","region"),this.isAudio()?this.el_.setAttribute("aria-label",this.localize("Audio Player")):this.el_.setAttribute("aria-label",this.localize("Video Player")),this.isAudio()&&this.addClass("vjs-audio"),this.flexNotSupported_()&&this.addClass("vjs-no-flex"),o.TOUCH_ENABLED&&this.addClass("vjs-touch-enabled"),o.IS_IOS||this.addClass("vjs-workinghover"),x.players[this.id_]=this;this.addClass("vjs-v7"),this.userActive(!0),this.reportUserActivity(),this.listenToOnce("play",this.listenForUserActivity_),this.listenTo("stageclick",this.handleStageClick_),this.listenTo("keydown",this.handleKeyDown),this.listenTo("languagechange",this.handleLanguagechange),this.breakpoints(this.options_.breakpoints),this.responsive(this.options_.responsive)}dispose(){this.trigger("dispose"),this.unlistenTo("dispose"),i.off(t,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),i.off(t,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),x.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),b.clearCacheForPlayer(this),k.ALL.names.forEach(t=>{const e=this[k[t].getterName]();e&&e.off&&e.off()}),super.dispose()}createEl(){let e,s=this.tag,i=this.playerElIngest_=s.parentNode&&s.parentNode.hasAttribute&&s.parentNode.hasAttribute("data-vjs-player");const h="video-js"===this.tag.tagName.toLowerCase();i?e=this.el_=s.parentNode:h||(e=this.el_=super.createEl("div"));const n=r.getAttributes(s);if(h){for(e=this.el_=s,s=this.tag=t.createElement("video");e.children.length;)s.appendChild(e.firstChild);r.hasClass(e,"video-js")||r.addClass(e,"video-js"),e.appendChild(s),i=this.playerElIngest_=e,Object.keys(e).forEach(t=>{try{s[t]=e[t]}catch(t){}})}if(s.setAttribute("tabindex","-1"),n.tabindex="-1",(o.IE_VERSION||o.IS_CHROME&&o.IS_WINDOWS)&&(s.setAttribute("role","application"),n.role="application"),s.removeAttribute("width"),s.removeAttribute("height"),"width"in n&&delete n.width,"height"in n&&delete n.height,Object.getOwnPropertyNames(n).forEach(function(t){h&&"class"===t||e.setAttribute(t,n[t]),h&&s.setAttribute(t,n[t])}),s.playerId=s.id,s.id+="_html5_api",s.className="vjs-tech",s.player=e.player=this,this.addClass("vjs-paused"),!0!==window.VIDEOJS_NO_DYNAMIC_STYLE){this.styleEl_=d.createStyleElement("vjs-styles-dimensions");const t=r.$(".vjs-styles-defaults"),e=r.$("head");e.insertBefore(this.styleEl_,t?t.nextSibling:e.firstChild)}this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);const a=s.getElementsByTagName("a");for(let t=0;t<a.length;t++){const e=a.item(t);r.addClass(e,"vjs-hidden"),e.setAttribute("hidden","hidden")}return s.initNetworkState_=s.networkState,s.parentNode&&!i&&s.parentNode.insertBefore(e,s),r.prependTo(s,e),this.children_.unshift(s),this.el_.setAttribute("lang",this.language_),this.el_=e,e}crossOrigin(t){if(!t)return this.techGet_("crossOrigin");"anonymous"===t||"use-credentials"===t?this.techCall_("setCrossOrigin",t):a.warn(`crossOrigin must be "anonymous" or "use-credentials", given "${t}"`)}width(t){return this.dimension("width",t)}height(t){return this.dimension("height",t)}dimension(t,e){const s=t+"_";if(void 0===e)return this[s]||0;if(""===e||"auto"===e)return this[s]=void 0,void this.updateStyleEl_();const i=parseFloat(e);isNaN(i)?a.error(`Improper value "${e}" supplied for for ${t}`):(this[s]=i,this.updateStyleEl_())}fluid(t){if(void 0===t)return!!this.fluid_;this.fluid_=!!t,s.isEvented(this)&&this.unlistenTo(["playerreset","resize"],this.updateStyleEl_),t?(this.addClass("vjs-fluid"),this.fill(!1),s.addEventedCallback(this,()=>{this.listenTo(["playerreset","resize"],this.updateStyleEl_)})):this.removeClass("vjs-fluid"),this.updateStyleEl_()}fill(t){if(void 0===t)return!!this.fill_;this.fill_=!!t,t?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")}aspectRatio(t){if(void 0===t)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(t))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=t,this.fluid(!0),this.updateStyleEl_()}updateStyleEl_(){if(!0===window.VIDEOJS_NO_DYNAMIC_STYLE){const t="number"==typeof this.width_?this.width_:this.options_.width,e="number"==typeof this.height_?this.height_:this.options_.height,s=this.tech_&&this.tech_.el();return void(s&&(t>=0&&(s.width=t),e>=0&&(s.height=e)))}let t,e,s,i;const r=(s=void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:this.videoWidth()>0?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"),h=r[1]/r[0];t=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/h:this.videoWidth()||300,e=void 0!==this.height_?this.height_:t*h,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),d.setTextContent(this.styleEl_,`\n      .${i} {\n        width: ${t}px;\n        height: ${e}px;\n      }\n\n      .${i}.vjs-fluid {\n        padding-top: ${100*h}%;\n      }\n    `)}loadTech_(t,e){this.tech_&&this.unloadTech_();const s=l.toTitleCase(t),i=t.charAt(0).toLowerCase()+t.slice(1);"Html5"!==s&&this.tag&&(C.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=s,this.isReady_=!1;const n={source:e,autoplay:"string"!=typeof this.autoplay()&&this.autoplay(),nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:`${this.id()}_${i}_api`,playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};k.ALL.names.forEach(t=>{const e=k.ALL[t];n[e.getterName]=this[e.privateName]}),y.assign(n,this.options_[s]),y.assign(n,this.options_[i]),y.assign(n,this.options_[t.toLowerCase()]),this.tag&&(n.tag=this.tag),e&&e.src===this.cache_.src&&this.cache_.currentTime>0&&(n.startTime=this.cache_.currentTime);const o=C.getTech(t);if(!o)throw new Error(`No Tech named '${s}' exists! '${s}' should be registered using videojs.registerTech()'`);this.tech_=new o(n),this.tech_.ready(h.bind(this,this.handleTechReady_),!0),m.jsonToTextTracks(this.textTracksJson_||[],this.tech_),A.forEach(t=>{this.listenTo(this.tech_,t,this[`handleTech${l.toTitleCase(t)}_`])}),Object.keys(E).forEach(t=>{this.listenTo(this.tech_,t,e=>{0===this.tech_.playbackRate()&&this.tech_.seeking()?this.queuedCallbacks_.push({callback:this[`handleTech${E[t]}_`].bind(this),event:e}):this[`handleTech${E[t]}_`](e)})}),this.listenTo(this.tech_,"loadstart",this.handleTechLoadStart_),this.listenTo(this.tech_,"sourceset",this.handleTechSourceset_),this.listenTo(this.tech_,"waiting",this.handleTechWaiting_),this.listenTo(this.tech_,"ended",this.handleTechEnded_),this.listenTo(this.tech_,"seeking",this.handleTechSeeking_),this.listenTo(this.tech_,"play",this.handleTechPlay_),this.listenTo(this.tech_,"firstplay",this.handleTechFirstPlay_),this.listenTo(this.tech_,"pause",this.handleTechPause_),this.listenTo(this.tech_,"durationchange",this.handleTechDurationChange_),this.listenTo(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_),this.listenTo(this.tech_,"fullscreenerror",this.handleTechFullscreenError_),this.listenTo(this.tech_,"enterpictureinpicture",this.handleTechEnterPictureInPicture_),this.listenTo(this.tech_,"leavepictureinpicture",this.handleTechLeavePictureInPicture_),this.listenTo(this.tech_,"error",this.handleTechError_),this.listenTo(this.tech_,"loadedmetadata",this.updateStyleEl_),this.listenTo(this.tech_,"posterchange",this.handleTechPosterChange_),this.listenTo(this.tech_,"textdata",this.handleTechTextData_),this.listenTo(this.tech_,"ratechange",this.handleTechRateChange_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===s&&this.tag||r.prependTo(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)}unloadTech_(){k.ALL.names.forEach(t=>{const e=k.ALL[t];this[e.privateName]=this[e.getterName]()}),this.textTracksJson_=m.textTracksToJson(this.tech_),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1}tech(t){return void 0===t&&a.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_}addTechControlsListeners_(){this.removeTechControlsListeners_(),this.listenTo(this.tech_,"mouseup",this.handleTechClick_),this.listenTo(this.tech_,"dblclick",this.handleTechDoubleClick_),this.listenTo(this.tech_,"touchstart",this.handleTechTouchStart_),this.listenTo(this.tech_,"touchmove",this.handleTechTouchMove_),this.listenTo(this.tech_,"touchend",this.handleTechTouchEnd_),this.listenTo(this.tech_,"tap",this.handleTechTap_)}removeTechControlsListeners_(){this.unlistenTo(this.tech_,"tap",this.handleTechTap_),this.unlistenTo(this.tech_,"touchstart",this.handleTechTouchStart_),this.unlistenTo(this.tech_,"touchmove",this.handleTechTouchMove_),this.unlistenTo(this.tech_,"touchend",this.handleTechTouchEnd_),this.unlistenTo(this.tech_,"mouseup",this.handleTechClick_),this.unlistenTo(this.tech_,"dblclick",this.handleTechDoubleClick_)}handleTechReady_(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()}handleTechLoadStart_(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay())}manualAutoplay_(t){if(!this.tech_||"string"!=typeof t)return;const e=()=>{const t=this.muted();this.muted(!0);const e=()=>{this.muted(t)};this.playTerminatedQueue_.push(e);const i=this.play();if(s.isPromise(i))return i.catch(e)};let s;return"any"===t&&!0!==this.muted()?(s=this.play()).isPromise(s)&&(s=s.catch(e)):s="muted"===t&&!0!==this.muted()?e():this.play(),s.isPromise(s)?s.then(()=>{this.trigger({type:"autoplay-success",autoplay:t})}).catch(e=>{this.trigger({type:"autoplay-failure",autoplay:t})}):void 0}updateSourceCaches_(t=""){let e=t,s="";"string"!=typeof e&&(e=t.src,s=t.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],e&&!s&&(s=w.findMimetype(this,e)),this.cache_.source=v({},t,{src:e,type:s});const i=this.cache_.sources.filter(t=>t.src&&t.src===e),h=[],n=this.$$("source"),o=[];for(let t=0;t<n.length;t++){const s=r.getAttributes(n[t]);h.push(s),s.src&&s.src===e&&o.push(s.src)}o.length&&!i.length?this.cache_.sources=h:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=e}handleTechSourceset_(t){if(!this.changingSrc_){let e=t=>this.updateSourceCaches_(t);const s=this.currentSource().src,i=t.src;s&&!/^blob:/.test(s)&&/^blob:/.test(i)&&(!this.lastSource_||this.lastSource_.tech!==i&&this.lastSource_.player!==s)&&(e=(()=>{})),e(i),t.src||this.tech_.any(["sourceset","loadstart"],t=>{if("sourceset"===t.type)return;const e=this.techGet("currentSrc");this.lastSource_.tech=e,this.updateSourceCaches_(e)})}this.lastSource_={player:this.currentSource().src,tech:t.src},this.trigger({src:t.src,type:"sourceset"})}hasStarted(t){if(void 0===t)return this.hasStarted_;t!==this.hasStarted_&&(this.hasStarted_=t,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))}handleTechPlay_(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")}handleTechRateChange_(){this.tech_.playbackRate()>0&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(t=>t.callback(t.event)),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")}handleTechWaiting_(){this.addClass("vjs-waiting"),this.trigger("waiting");const t=this.currentTime(),e=()=>{t!==this.currentTime()&&(this.removeClass("vjs-waiting"),this.unlistenTo("timeupdate",e))};this.listenTo("timeupdate",e)}handleTechCanPlay_(){this.removeClass("vjs-waiting"),this.trigger("canplay")}handleTechCanPlayThrough_(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")}handleTechPlaying_(){this.removeClass("vjs-waiting"),this.trigger("playing")}handleTechSeeking_(){this.addClass("vjs-seeking"),this.trigger("seeking")}handleTechSeeked_(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")}handleTechFirstPlay_(){this.options_.starttime&&(a.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")}handleTechPause_(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")}handleTechEnded_(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")}handleTechDurationChange_(){this.duration(this.techGet_("duration"))}handleTechClick_(t){r.isSingleLeftClick(t)&&this.controls_&&(this.paused()?f.silencePromise(this.play()):this.pause())}handleTechDoubleClick_(t){if(!this.controls_)return;Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),e=>e.contains(t.target))||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,t):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen())}handleTechTap_(){this.userActive(!this.userActive())}handleTechTouchStart_(){this.userWasActive=this.userActive()}handleTechTouchMove_(){this.userWasActive&&this.reportUserActivity()}handleTechTouchEnd_(t){t.cancelable&&t.preventDefault()}handleStageClick_(){this.reportUserActivity()}toggleFullscreenClass_(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")}documentFullscreenChange_(e){const s=e.target.player;if(s&&s!==this)return;const i=this.el();let r=t[this.fsApi_.fullscreenElement]===i;!r&&i.matches?r=i.matches(":"+this.fsApi_.fullscreen):!r&&i.msMatchesSelector&&(r=i.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(r)}handleTechFullscreenChange_(t,e){e&&(e.nativeIOSFullscreen&&this.toggleClass("vjs-ios-native-fs"),this.isFullscreen(e.isFullscreen))}handleTechFullscreenError_(t,e){this.trigger("fullscreenerror",e)}togglePictureInPictureClass_(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")}handleTechEnterPictureInPicture_(t){this.isInPictureInPicture(!0)}handleTechLeavePictureInPicture_(t){this.isInPictureInPicture(!1)}handleTechError_(){const t=this.tech_.error();this.error(t)}handleTechTextData_(){let t=null;arguments.length>1&&(t=arguments[1]),this.trigger("textdata",t)}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],volume:1}}techCall_(t,e){this.ready(function(){if(t in b.allowedSetters)return b.set(this.middleware_,this.tech_,t,e);if(t in b.allowedMediators)return b.mediate(this.middleware_,this.tech_,t,e);try{this.tech_&&this.tech_[t](e)}catch(t){throw a(t),t}},!0)}techGet_(t){if(this.tech_&&this.tech_.isReady_){if(t in b.allowedGetters)return b.get(this.middleware_,this.tech_,t);if(t in b.allowedMediators)return b.mediate(this.middleware_,this.tech_,t);try{return this.tech_[t]()}catch(e){if(void 0===this.tech_[t])throw a(`Video.js: ${t} method not defined for ${this.techName_} playback technology.`,e),e;if("TypeError"===e.name)throw a(`Video.js: ${t} unavailable on ${this.techName_} playback technology element.`,e),this.tech_.isReady_=!1,e;throw a(e),e}}}play(){const t=this.options_.Promise||window.Promise;return t?new t(t=>{this.play_(t)}):this.play_()}play_(t=f.silencePromise){this.playCallbacks_.push(t);const e=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.unlistenTo(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!e)return this.waitToPlay_=(t=>{this.play_()}),this.listenToOnce(["ready","loadstart"],this.waitToPlay_),void(e||!o.IS_ANY_SAFARI&&!o.IS_IOS||this.load());const s=this.techGet_("play");null===s?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(s)}runPlayTerminatedQueue_(){const t=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],t.forEach(function(t){t()})}runPlayCallbacks_(t){const e=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],e.forEach(function(e){e(t)})}pause(){this.techCall_("pause")}paused(){return!1!==this.techGet_("paused")}played(){return this.techGet_("played")||c.createTimeRange(0,0)}scrubbing(t){if(void 0===t)return this.scrubbing_;this.scrubbing_=!!t,this.techCall_("setScrubbing",this.scrubbing_),t?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")}currentTime(t){return void 0!==t?(t<0&&(t=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",t),void(this.cache_.initTime=0)):(this.cache_.initTime=t,this.unlistenTo("canplay",this.applyInitTime_),void this.listenToOnce("canplay",this.applyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)}applyInitTime_(){this.currentTime(this.cache_.initTime)}duration(t){if(void 0===t)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(t=parseFloat(t))<0&&(t=1/0),t!==this.cache_.duration&&(this.cache_.duration=t,t===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(t)||this.trigger("durationchange"))}remainingTime(){return this.duration()-this.currentTime()}remainingTimeDisplay(){return Math.floor(this.duration())-Math.floor(this.currentTime())}buffered(){let t=this.techGet_("buffered");return t&&t.length||(t=c.createTimeRange(0,0)),t}bufferedPercent(){return u.bufferedPercent(this.buffered(),this.duration())}bufferedEnd(){const t=this.buffered(),e=this.duration();let s=t.end(t.length-1);return s>e&&(s=e),s}volume(t){let e;return void 0!==t?(e=Math.max(0,Math.min(1,parseFloat(t))),this.cache_.volume=e,this.techCall_("setVolume",e),void(e>0&&this.lastVolume_(e))):(e=parseFloat(this.techGet_("volume")),isNaN(e)?1:e)}muted(t){if(void 0===t)return this.techGet_("muted")||!1;this.techCall_("setMuted",t)}defaultMuted(t){return void 0!==t?this.techCall_("setDefaultMuted",t):this.techGet_("defaultMuted")||!1}lastVolume_(t){if(void 0===t||0===t)return this.cache_.lastVolume;this.cache_.lastVolume=t}supportsFullScreen(){return this.techGet_("supportsFullScreen")||!1}isFullscreen(t){if(void 0!==t){const e=this.isFullscreen_;return this.isFullscreen_=Boolean(t),this.isFullscreen_!==e&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),void this.toggleFullscreenClass_()}return this.isFullscreen_}requestFullscreen(t){const e=this.options_.Promise||window.Promise;if(e){const s=this;return new e((e,i)=>{function r(){s.off("fullscreenerror",n),s.off("fullscreenchange",h)}function h(){r(),e()}function n(t,e){r(),i(e)}s.one("fullscreenchange",h),s.one("fullscreenerror",n);const o=s.requestFullscreenHelper_(t);if(o)return o.then(r,r),o})}return this.requestFullscreenHelper_()}requestFullscreenHelper_(t){let e;if(this.fsApi_.prefixed||(e=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==t&&(e=t)),this.fsApi_.requestFullscreen){const t=this.el_[this.fsApi_.requestFullscreen](e);return t&&t.then(()=>this.isFullscreen(!0),()=>this.isFullscreen(!1)),t}this.tech_.supportsFullScreen()?this.techCall_("enterFullScreen"):this.enterFullWindow()}exitFullscreen(){const t=this.options_.Promise||window.Promise;if(t){const e=this;return new t((t,s)=>{function i(){e.off("fullscreenerror",h),e.off("fullscreenchange",r)}function r(){i(),t()}function h(t,e){i(),s(e)}e.one("fullscreenchange",r),e.one("fullscreenerror",h);const n=e.exitFullscreenHelper_();if(n)return n.then(i,i),n})}return this.exitFullscreenHelper_()}exitFullscreenHelper_(){if(this.fsApi_.requestFullscreen){const e=t[this.fsApi_.exitFullscreen]();return e&&e.then(()=>this.isFullscreen(!1)),e}this.tech_.supportsFullScreen()?this.techCall_("exitFullScreen"):this.exitFullWindow()}enterFullWindow(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=t.documentElement.style.overflow,i.on(t,"keydown",this.boundFullWindowOnEscKey_),t.documentElement.style.overflow="hidden",r.addClass(t.body,"vjs-full-window"),this.trigger("enterFullWindow")}fullWindowOnEscKey(t){S.isEventKey(t,"Esc")&&(!0===this.isFullscreen()?this.exitFullscreen():this.exitFullWindow())}exitFullWindow(){this.isFullscreen(!1),this.isFullWindow=!1,i.off(t,"keydown",this.boundFullWindowOnEscKey_),t.documentElement.style.overflow=this.docOrigOverflow,r.removeClass(t.body,"vjs-full-window"),this.trigger("exitFullWindow")}disablePictureInPicture(t){if(void 0===t)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",t),this.options_.disablePictureInPicture=t,this.trigger("disablepictureinpicturechanged")}isInPictureInPicture(t){return void 0!==t?(this.isInPictureInPicture_=!!t,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_}requestPictureInPicture(){if("pictureInPictureEnabled"in t&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")}exitPictureInPicture(){if("pictureInPictureEnabled"in t)return t.exitPictureInPicture()}handleKeyDown(t){const{userActions:e}=this.options_;if(!e||!e.hotkeys)return;(t=>{const e=t.tagName.toLowerCase();if(t.isContentEditable)return!0;if("input"===e)return-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(t.type);return-1!==["textarea"].indexOf(e)})(this.el_.ownerDocument.activeElement)||("function"==typeof e.hotkeys?e.hotkeys.call(this,t):this.handleHotkeys(t))}handleHotkeys(s){const i=this.options_.userActions?this.options_.userActions.hotkeys:{},{fullscreenKey:r=(t=>S.isEventKey(t,"f")),muteKey:h=(t=>S.isEventKey(t,"m")),playPauseKey:n=(t=>S.isEventKey(t,"k")||S.isEventKey(t,"Space"))}=i;if(r.call(this,s)){s.preventDefault(),s.stopPropagation();const i=e.getComponent("FullscreenToggle");!1!==t[this.fsApi_.fullscreenEnabled]&&i.prototype.handleClick.call(this,s)}else if(h.call(this,s)){s.preventDefault(),s.stopPropagation(),e.getComponent("MuteToggle").prototype.handleClick.call(this,s)}else if(n.call(this,s)){s.preventDefault(),s.stopPropagation(),e.getComponent("PlayToggle").prototype.handleClick.call(this,s)}}canPlayType(t){let s;for(let i=0,r=this.options_.techOrder;i<r.length;i++){const h=r[i];let n=C.getTech(h);if(n||(n=e.getComponent(h)),n){if(n.isSupported()&&(s=n.canPlayType(t)))return s}else a.error(`The "${h}" tech is undefined. Skipped browser support check for that tech.`)}return""}selectSource(t){const e=this.options_.techOrder.map(t=>[t,C.getTech(t)]).filter(([t,e])=>e?e.isSupported():(a.error(`The "${t}" tech is undefined. Skipped browser support check for that tech.`),!1)),s=function(t,e,s){let i;return t.some(t=>e.some(e=>{if(i=s(t,e))return!0})),i};let i;const r=([t,e],s)=>{if(e.canPlaySource(s,this.options_[t.toLowerCase()]))return{source:s,tech:t}};return(i=this.options_.sourceOrder?s(t,e,(t=>(e,s)=>t(s,e))(r)):s(e,t,r))||!1}src(t){if(void 0===t)return this.cache_.src||"";const e=P(t);e.length?(this.changingSrc_=!0,this.cache_.sources=e,this.updateSourceCaches_(e[0]),b.setSource(this,e[0],(t,s)=>{if(this.middleware_=s,this.cache_.sources=e,this.updateSourceCaches_(t),this.src_(t))return e.length>1?this.src(e.slice(1)):(this.changingSrc_=!1,this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void this.triggerReady());b.setTech(s,this.tech_)})):this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)}src_(t){const e=this.selectSource([t]);return!e||(l.titleCaseEquals(e.tech,this.techName_)?(this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",t):this.techCall_("src",t.src),this.changingSrc_=!1},!0),!1):(this.changingSrc_=!0,this.loadTech_(e.tech,e.source),this.tech_.ready(()=>{this.changingSrc_=!1}),!1))}load(){this.techCall_("load")}reset(){const t=this.options_.Promise||window.Promise;if(this.paused()||!t)this.doReset_();else{const t=this.play();f.silencePromise(t.then(()=>this.doReset_()))}}doReset_(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),s.isEvented(this)&&this.trigger("playerreset")}resetControlBarUI_(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()}resetProgressBar_(){this.currentTime(0);const{durationDisplay:t,remainingTimeDisplay:e}=this.controlBar;t&&t.updateContent(),e&&e.updateContent()}resetPlaybackRate_(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()}resetVolumeBar_(){this.volume(1),this.trigger("volumechange")}currentSources(){const t=this.currentSource(),e=[];return 0!==Object.keys(t).length&&e.push(t),this.cache_.sources||e}currentSource(){return this.cache_.source||{}}currentSrc(){return this.currentSource()&&this.currentSource().src||""}currentType(){return this.currentSource()&&this.currentSource().type||""}preload(t){return void 0!==t?(this.techCall_("setPreload",t),void(this.options_.preload=t)):this.techGet_("preload")}autoplay(t){if(void 0===t)return this.options_.autoplay||!1;let e;"string"==typeof t&&/(any|play|muted)/.test(t)?(this.options_.autoplay=t,this.manualAutoplay_(t),e=!1):this.options_.autoplay=!!t,e=void 0===e?this.options_.autoplay:e,this.tech_&&this.techCall_("setAutoplay",e)}playsinline(t){return void 0!==t?(this.techCall_("setPlaysinline",t),this.options_.playsinline=t,this):this.techGet_("playsinline")}loop(t){return void 0!==t?(this.techCall_("setLoop",t),void(this.options_.loop=t)):this.techGet_("loop")}poster(t){if(void 0===t)return this.poster_;t||(t=""),t!==this.poster_&&(this.poster_=t,this.techCall_("setPoster",t),this.isPosterFromTech_=!1,this.trigger("posterchange"))}handleTechPosterChange_(){if((!this.poster_||this.options_.techCanOverridePoster)&&this.tech_&&this.tech_.poster){const t=this.tech_.poster()||"";t!==this.poster_&&(this.poster_=t,this.isPosterFromTech_=!0,this.trigger("posterchange"))}}controls(t){if(void 0===t)return!!this.controls_;t=!!t,this.controls_!==t&&(this.controls_=t,this.usingNativeControls()&&this.techCall_("setControls",t),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))}usingNativeControls(t){if(void 0===t)return!!this.usingNativeControls_;t=!!t,this.usingNativeControls_!==t&&(this.usingNativeControls_=t,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))}error(t){if(void 0===t)return this.error_||null;if(this.options_.suppressNotSupportedError&&t&&4===t.code){const e=function(){this.error(t)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],e),void this.listenToOnce("loadstart",function(){this.unlistenTo(["click","touchstart"],e)})}if(null===t)return this.error_=t,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new p(t),this.addClass("vjs-error"),a.error(`(CODE:${this.error_.code} ${p.errorTypes[this.error_.code]})`,this.error_.message,this.error_),this.trigger("error")}reportUserActivity(t){this.userActivity_=!0}userActive(t){if(void 0===t)return this.userActive_;if((t=!!t)!==this.userActive_){if(this.userActive_=t,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}}listenForUserActivity_(){let t,e,s;const i=h.bind(this,this.reportUserActivity),r=function(e){i(),this.clearInterval(t)};this.listenTo("mousedown",function(){i(),this.clearInterval(t),t=this.setInterval(i,250)}),this.listenTo("mousemove",function(t){t.screenX===e&&t.screenY===s||(e=t.screenX,s=t.screenY,i())}),this.listenTo("mouseup",r),this.listenTo("mouseleave",r);const n=this.getChild("controlBar");let a;!n||o.IS_IOS||o.IS_ANDROID||(n.on("mouseenter",function(t){this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout,this.player().options_.inactivityTimeout=0}),n.on("mouseleave",function(t){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.listenTo("keydown",i),this.listenTo("keyup",i),this.setInterval(function(){if(!this.userActivity_)return;this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a);const t=this.options_.inactivityTimeout;t<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},t))},250)}playbackRate(t){if(void 0===t)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",t)}defaultPlaybackRate(t){return void 0!==t?this.techCall_("setDefaultPlaybackRate",t):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1}isAudio(t){if(void 0===t)return!!this.isAudio_;this.isAudio_=!!t}addTextTrack(t,e,s){if(this.tech_)return this.tech_.addTextTrack(t,e,s)}addRemoteTextTrack(t,e){if(this.tech_)return this.tech_.addRemoteTextTrack(t,e)}removeRemoteTextTrack(t={}){let{track:e}=t;if(e||(e=t),this.tech_)return this.tech_.removeRemoteTextTrack(e)}getVideoPlaybackQuality(){return this.techGet_("getVideoPlaybackQuality")}videoWidth(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0}videoHeight(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0}language(t){if(void 0===t)return this.language_;this.language_!==String(t).toLowerCase()&&(this.language_=String(t).toLowerCase(),s.isEvented(this)&&this.trigger("languagechange"))}languages(){return v(x.prototype.options_.languages,this.languages_)}toJSON(){const t=v(this.options_),e=t.tracks;t.tracks=[];for(let s=0;s<e.length;s++){let i=e[s];(i=v(i)).player=void 0,t.tracks[s]=i}return t}createModal(t,e){(e=e||{}).content=t||"";const s=new T(this,e);return this.addChild(s),s.on("dispose",()=>{this.removeChild(s)}),s.open(),s}updateCurrentBreakpoint_(){if(!this.responsive())return;const t=this.currentBreakpoint(),e=this.currentWidth();for(let s=0;s<j.length;s++){const i=j[s];if(e<=this.breakpoints_[i]){if(t===i)return;t&&this.removeClass(F[t]),this.addClass(F[i]),this.breakpoint_=i;break}}}removeCurrentBreakpoint_(){const t=this.currentBreakpointClass();this.breakpoint_="",t&&this.removeClass(t)}breakpoints(t){return void 0===t?y.assign(this.breakpoints_):(this.breakpoint_="",this.breakpoints_=y.assign({},I,t),this.updateCurrentBreakpoint_(),y.assign(this.breakpoints_))}responsive(t){if(void 0===t)return this.responsive_;return(t=Boolean(t))!==this.responsive_?(this.responsive_=t,t?(this.listenTo("playerresize",this.updateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.unlistenTo("playerresize",this.updateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),t):void 0}currentBreakpoint(){return this.breakpoint_}currentBreakpointClass(){return F[this.breakpoint_]||""}loadMedia(t,e){if(!t||"object"!=typeof t)return;this.reset(),this.cache_.media=v(t);const{artwork:s,poster:i,src:r,textTracks:h}=this.cache_.media;!s&&i&&(this.cache_.media.artwork=[{src:i,type:w.getMimetype(i)}]),r&&this.src(r),i&&this.poster(i),Array.isArray(h)&&h.forEach(t=>this.addRemoteTextTrack(t,!1)),this.ready(e)}getMedia(){if(!this.cache_.media){const t=this.poster(),e={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),t=>({kind:t.kind,label:t.label,language:t.language,src:t.src}))};return t&&(e.poster=t,e.artwork=[{src:e.poster,type:w.getMimetype(e.poster)}]),e}return v(this.cache_.media)}static getTagSettings(t){const e={sources:[],tracks:[]},s=r.getAttributes(t),i=s["data-setup"];if(r.hasClass(t,"vjs-fill")&&(s.fill=!0),r.hasClass(t,"vjs-fluid")&&(s.fluid=!0),null!==i){const[t,e]=g(i||"{}");t&&a.error(t),y.assign(s,e)}if(y.assign(e,s),t.hasChildNodes()){const s=t.childNodes;for(let t=0,i=s.length;t<i;t++){const i=s[t],h=i.nodeName.toLowerCase();"source"===h?e.sources.push(r.getAttributes(i)):"track"===h&&e.tracks.push(r.getAttributes(i))}}return e}flexNotSupported_(){const e=t.createElement("i");return!("flexBasis"in e.style||"webkitFlexBasis"in e.style||"mozFlexBasis"in e.style||"msFlexBasis"in e.style||"msFlexOrder"in e.style)}debug(t){if(void 0===t)return this.debugEnabled_;t?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)}}k.ALL.names.forEach(function(t){const e=k.ALL[t];x.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}}),x.prototype.crossorigin=x.prototype.crossOrigin,x.players={};const N=window.navigator;return x.prototype.options_={techOrder:C.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:N&&(N.languages&&N.languages[0]||N.userLanguage||N.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(t){x.prototype[t]=function(){return this.techGet_(t)}}),A.forEach(function(t){x.prototype[`handleTech${l.toTitleCase(t)}_`]=function(){return this.trigger(t)}}),e.registerComponent("Player",x),x});
//# sourceMappingURL=sourcemaps/player.js.map
